<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Currency Converter</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <h1>Currency Converter</h1>

    <!-- Conversion Form -->
    <form id="convertForm">
      <input type="number" id="amount" placeholder="Amount" required>
      <input type="text" id="from" placeholder="From Currency (e.g., USD)" required>
      <input type="text" id="to" placeholder="To Currency (e.g., EUR)" required>
      <button type="submit" class="add-btn">Convert</button>
    </form>

    <!-- Conversion Result -->
    <div id="result"></div>

    <!-- Conversion History -->
    <h2>Last 5 Conversions</h2>
    <ul id="historyList">
      {% for entry in history %}
        <li>{{ entry.amount }} {{ entry.from }} → {{ entry.converted }} {{ entry.to }}</li>
      {% endfor %}
    </ul>
  </div>

  <script>
    const API_BASE = "http://127.0.0.1:5000";

    document.getElementById("convertForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const amount = document.getElementById("amount").value;
      const from = document.getElementById("from").value.toUpperCase();
      const to = document.getElementById("to").value.toUpperCase();

      const res = await fetch(`${API_BASE}/convert`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ amount, from, to })
      });
      const data = await res.json();

      if (data.error) {
        document.getElementById("result").textContent = data.error;
      } else {
        document.getElementById("result").textContent = 
          `${data.amount} ${data.from} = ${data.converted} ${data.to}`;
        loadHistory();
      }
    });

    async function loadHistory() {
      const res = await fetch(`${API_BASE}/history`);
      const history = await res.json();
      const list = document.getElementById("historyList");
      list.innerHTML = "";
      history.forEach(entry => {
        list.innerHTML += `<li>${entry.amount} ${entry.from} → ${entry.converted} ${entry.to}</li>`;
      });
    }

    // Initial load
    loadHistory();
  </script>
</body>
</html>
